환경

-   육군 서버(실물): 네트워크 망에 접속되어 있지 않은 단독 운용

1. Ip address, gateway 등을 임의로 지정

-   하나금융 (클라우드): VDI로 발급받은 레드햇 7.9 서버

문제 상황 및 해결방안

-   육군 (테스트 환경에서 진행)

1. 문제: 쿠버네티스 서버 기동 실패: 쿠버네티스는 default gateway 셋팅이 존재해야 실행가능

Ø 해결: 임의의 ip address, gateway를 설정하여 쿠버네티스 서버 실행 가능

2. 문제: 쿠버네티스에서 이미지를 가져올 수 없음

Ø 상세: 네트워크 망이 정상 구축되어 있는 것이 아니므로 내부 쿠버네티스 서버에서 호스트를 통해 데이터를 가져올 수 없음

l 쿠버네티스에서 host의 [https://192.168.2.100:6443/filepath](https://192.168.2.100:6443/filepath) (예시)를 호출할 때 host의 정보를 가져올 수 없음.

l Nmap 으로 host의 ip에 포트스캐닝을 해보면 응답이 없음을 확인할 수 있음. -> 초기에 서버에 정보가 없을 때 데이터를 요청해도 응답 받을 수 없음

Ø 해결: 이미지 수동 삽입을 통해 쿠버네티스에서 호스트에 데이터를 요청하는 과정을 스킵할 수 있음

3. 문제: DNS 무한루프

Ø 상세: 쿠버네티스에서 내부에서 서비스를 하기위해 쿠버네티스 DNS를 구성. DNS를 담당하는 컨테이너가 기동 실패하면서 문제 발생

l 서버는 외부 dns 서버의 유무를 알 수 없으므로 dns를 localhost로 대체 (127.0.0.53)

l 쿠버네티스의 dns 컨테이너는 호스트의 dns nameserver 정보를 가져감 (/etc/resolv.conf)

l 쿠버네티스 입장에서 자기 자신을 dns로 잡은 셈이므로 dns를 쿼리하면 계속해서 쿠버네티스 dns로 돌아오는 루프현상 발생 -> crash

Ø 해결: 호스트의 /etc/resolv.conf 의 nameserver를 localhost가 아닌 다른 주소로 지정

l Ubuntu의 경우 resolvconf 서비스 설치로 대체 가능

4. 문제: db 초기화 과정에서 유저 등록이 안됨 -> 라이선스 등록이 안됨

Ø 상세: 초기화 과정에서 vray-db에 유저가 등록되어야 하나 해당 과정이 정상 수행되지 않음

Ø 해결: create-user.yaml을 직접 실행시켜서 유저를 등록하거나 PostgreSQL에 직접 들어가서 유저를 등록하는 방법이 있음

5. 완료

-   하나금융 (클라우드)

1. 문제: DNS 무한루프 – 원인은 동일하나 현상에서 차이 있음

Ø 원인: 하나 클라우디아 네트워크 환경에서 dns 서버 정보를 저장하지 않음 - /etc/resolv.conf empty

l 클라우디아 레드햇의 시스템은 기동 시에 nameserver에 대한 정보를 저장하는 루틴이 없는 것으로 보여짐

l 해결: /etc/resolv.conf 내부에 임의로 nameserver 기재. 해당 정보는 수정되지 않으므로 nameserver를 따로 기동할 필요는 없다고 보여짐

Ø 파생 현상 상세: 시스템용 컨테이너의 실행이 실패함

l 쿠버네티스의 apiserver에 접속할 수 없음

l 쿠버네티스의 DNS 컨테이너가 동작하지 않음으로 인해 위의 현상이 발생함

2. 문제: 쿠버네티스 DNS 컨테이너로의 패킷이 Reject됨 -> DNS에서 나가는 패킷이 거절되니 no route to host 메시지와 함께 네트워킹이 되지 않음

Ø 상세: 쿠버네티스 DNS 컨테이너에서 지속적으로 패킷을 보내면서 호스트 및 쿠버네티스 서버에서 해당 ip로 접근하는 패킷이 reject 됨.

l Iptables 셋팅을 초기화해도 현상이 해결되지 않음

l 해결: 클린 & 재설치

3. 문제: 라이선스 등록이 안됨

Ø 상세: vray-db에 유저가 등록되어 있음을 확인했으나 license 등록에 실패

Ø 해결: vray-db에 직접 라이선스 정보 등록

4. 완료